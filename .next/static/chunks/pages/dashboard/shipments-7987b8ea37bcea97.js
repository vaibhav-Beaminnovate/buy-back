(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5088],{91950:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/shipments",function(){return s(61185)}])},12115:function(e,t,s){"use strict";var a=s(85893);s(67294),t.Z=e=>{let{itemsPerPage:t,setItemsPerPage:s,currentPage:n,setCurrentPage:r,totalEntries:i,totalPages:c}=e;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center pt-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("label",{htmlFor:"items",className:"text-sm",children:"Items per page:"}),(0,a.jsx)("select",{id:"items",className:"border border-gray-300 rounded-md py-1 px-2 ring-accent",value:t,onChange:e=>{s(parseInt(e.target.value,10)),r(1)},children:[15,20,25,30,35].map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-3 md:mt-0",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:[t*n-t+1," to"," ",t*n<i?t*n:i," ","of ",i]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("button",{onClick:()=>r(1),disabled:1===n,className:"p-2 rounded-full ring-accent ".concat(n>1?"text-accent":"text-gray-400"),children:(0,a.jsx)("i",{className:"bi bi-chevron-bar-left text-lg"})}),(0,a.jsx)("button",{onClick:()=>r(e=>e>1?e-1:e),disabled:1===n,className:"p-2 rounded-full ring-accent ".concat(n>1?"text-accent":"text-gray-400"),children:(0,a.jsx)("i",{className:"bi bi-chevron-left text-lg"})}),(0,a.jsx)("button",{onClick:()=>r(e=>e<c?e+1:e),disabled:n===c,className:"p-2 rounded-full ring-accent ".concat(n<c?"text-accent":"text-gray-400"),children:(0,a.jsx)("i",{className:"bi bi-chevron-right text-lg"})}),(0,a.jsx)("button",{onClick:()=>r(c),disabled:n===c,className:"p-2 rounded-full ring-accent ".concat(n<c?"text-accent":"text-gray-400"),children:(0,a.jsx)("i",{className:"bi bi-chevron-bar-right text-lg"})})]})]})]})}},4625:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(67294);function n(e,t){let[s,n]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let s=setTimeout(()=>{n(e)},t);return()=>{clearTimeout(s)}},[e]),s}},61185:function(e,t,s){"use strict";s.r(t);var a=s(85893),n=s(67294),r=s(4625),i=s(12115),c=s(11163),l=s(9134),o=s(32553),d=s(41664),h=s.n(d),u=s(5152),m=s.n(u),p=s(86455),x=s.n(p),g=s(67957),f=s(14930),b=s(4483),y=s(10405),j=s(44265),w=s(87740),N=s(86597),v=s(77161),_=s(93218),k=s(44877),S=s(42967),C=s(96180),D=s(47168),A=s(78148),E=s(29276),O=s(96476),q=s(9008),P=s.n(q),T=s(39840);m()(()=>s.e(8607).then(s.t.bind(s,68607,23)),{loadableGenerated:{webpack:()=>[68607]},ssr:!1}),t.default=()=>{let e="https://buybackservice.unicornstore.in";(0,c.useRouter)();let[t,s]=(0,n.useState)(null),[d,u]=(0,n.useState)(15),[m,p]=(0,n.useState)(1),[q,I]=(0,n.useState)(null),[R,B]=(0,n.useState)(null),[z,F]=(0,n.useState)(""),L=(0,r.Z)(z,500),[U,X]=(0,n.useState)(!0),[Z,J]=(0,n.useState)(""),{isOpen:M,onOpen:Q,onOpenChange:W}=(0,g.q)(),[G,K]=(0,n.useState)(new Set([])),H=[{key:"shipment_id",label:"Shipment ID"},{key:"store",label:"Store"},{key:"shipping_class",label:"Shipping Class"},{key:"weight_in_kg",label:"Weight"},{key:"status",label:"Status"}],[V,Y]=(0,n.useState)(""),[$,ee]=(0,n.useState)({table:"",requestedOn:""}),[et,es]=(0,n.useState)({key:"",direction:"descending"}),ea=(0,o.dQ)(),en=async()=>{let t=localStorage.getItem("staff_id");try{X(!0);let a=et.key,n="descending"===et.direction,r=await fetch("".concat(e,"/get-all-shipments?page=").concat(m,"&per_page=").concat(d,"&sort_by=").concat(a,"&sort_desc=").concat(n,"&search=").concat(z,"&staff_id=").concat(t),{headers:{Authorization:ea}});if(!r.ok)throw Error("Could not get shipment Res");let i=await r.json();s(i.data),B(i.total_count),I(Math.ceil(i.total_count/d)),i.data.forEach(e=>{J(t=>({...t,[e.shipment_id]:e.status}))})}catch(e){l.Am.error(e.message)}finally{setTimeout(()=>{X(!1)},400)}};(0,n.useEffect)(()=>{en()},[m,d,et]),(0,n.useEffect)(()=>{""!==L&&(p(1),en())},[L,z]);let er=e=>{let t="ascending";et.key===e&&"ascending"===et.direction&&(t="descending"),es({key:e,direction:t}),p(1)},ei=e=>(0,a.jsx)("i",{className:"fas fa-arrow-down inline-block my-auto text-xs text-gray-600 pt-0.5 ".concat("ascending"===et.direction?"rotate-180":""," transition-all ").concat(et.key!==e?"hidden":"")}),ec=async(t,s)=>{try{let a=await fetch("".concat(e,"/update-shipment?shipment_id=").concat(t),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:ea},body:JSON.stringify({status:s})});if(!a.ok)throw Error("Could not update shipment");let n=await a.json();if("success"!==n.status)throw Error(n.message);J(e=>({...e,[t]:s})),en()}catch(e){l.Am.error(e.message)}},el=async t=>{x().fire({title:"Delete Shipment?",text:"Are you sure you want to delete this item? This action cannot be undone.",icon:"warning",showConfirmButton:!0,showCancelButton:!0,reverseButtons:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#9ca3af"}).then(async s=>{if(s.isConfirmed)try{let s=await fetch("".concat(e,"/delete-shipment?shipment_id=").concat(t),{method:"DELETE",headers:{Authorization:ea}});if(!s.ok)throw Error("Could not delete shipment");let a=await s.json();if("success"!==a.status)throw Error(a.message);l.Am.success(a.message),en()}catch(e){l.Am.error(e.message)}})},eo=async t=>{try{let s=await fetch("".concat(e,"/packing-slip-pdf/?shipment_id=").concat(t),{headers:{Authorization:ea}});if(!s.ok)throw Error("Could not get slip");let a=await s.json();if("success"!==a.status)throw Error(a.message);window.open(a.url,"_blank")}catch(e){l.Am.error(e.message)}},ed=async t=>{try{let s=await fetch("".concat(e,"/track-delivery/?shipment_id=").concat(t),{method:"POST",headers:{Authorization:ea}});if(!s.ok)throw Error("Could not track shipment");let a=await s.json();x().fire({title:"Shipment Status",text:a.shipment_status||a.message,icon:a.status})}catch(e){l.Am.error(e.message)}},eh=e=>new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(e),eu=e=>{let t=e.target.value,s=new Date;s.setDate(s.getDate());let a=new Date(s);a.setDate(s.getDate()+8);let n={};if(t){let e=new Date(t);e<s||e>a?n.requestedOn="Please select a date between ".concat(eh(new Date(s).setDate(s.getDate()+1))," and ").concat(eh(a)):n.requestedOn=""}else n.requestedOn="Requested Date is required";ee(e=>({...e,...n}))},em=e=>{let t={};0===Array.from(e,Number).length?t.table="At least one shipment is required":t.table="",ee(e=>({...e,...t}))},ep=()=>{let e=new Date;e.setDate(e.getDate());let t=new Date(e);t.setDate(e.getDate()+8);let s={};if(0===Array.from(G,Number).length?s.table="At least one shipment is required":s.table="",V.trim()){let a=new Date(V);a<e||a>t?s.requestedOn="Please select a date between ".concat(eh(new Date(e).setDate(e.getDate()+1))," and ").concat(eh(t)):s.requestedOn=""}else s.requestedOn="Requested Date is required";return ee(s),Object.keys(s).every(e=>""===s[e])},ex=async t=>{try{if(!ep())return;t();let s=Array.from(G,Number),a=await fetch("".concat(e,"/create-shipment-pickup"),{method:"POST",headers:{"Content-Type":"application/json",headers:{Authorization:ea}},body:JSON.stringify({staff_id:localStorage.getItem("staff_id"),pickup_datetime:V,shipment_ids:s})});if(!a.ok)throw Error("Could not create shipment pickup");let n=await a.json();if("success"!==n.status)throw Error(n.message);l.Am.success(n.message)}catch(e){l.Am.error(e.message)}},eg=async e=>{(0,T.u)("get-shipment-export/".concat(e),{},"Shipment ".concat(e," Devices Data"))};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex justify-center bg-gray-100 min-h-screen h-full relative -top-28",children:[(0,a.jsx)(P(),{children:(0,a.jsx)("title",{children:"BuyBack - Store Dashboard | Shipments"})}),(0,a.jsx)("div",{className:"container max-w-screen-xl mx-4",children:(0,a.jsxs)("div",{className:"flex flex-col bg-white p-4 my-4 rounded-lg shadow justify-center space-y-2",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Store Dashboard | Shipments"}),(0,a.jsx)("div",{className:"relative flex gap-x-4",children:(0,a.jsxs)(h(),{href:"/dashboard/shipments/create-shipment",className:"bg-accent text-white px-4 py-2 rounded ring-accent",children:[(0,a.jsx)("i",{className:"fas fa-plus"})," Create Shipment"]})}),(0,a.jsx)("label",{className:"text-sm text-gray-700",htmlFor:"searchQuery",children:"Search by Shipment ID, Store, Shipment Class or Status"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",id:"searchQuery",className:"border border-gray-400 py-2 px-2 rounded-md w-full ring-accent col-span-6",name:"search-bar",value:z,onChange:e=>F(e.target.value),spellCheck:!1,autoComplete:"off",placeholder:"Search by Shipment ID, Store, Shipment Class or Status"}),(0,a.jsx)("div",{className:"relative space-x-2 w-fit whitespace-nowrap",children:(0,a.jsx)(f.A,{className:"px-3 py-1 rounded bg-accent text-white cursor-pointer ring-accent h-full",onPress:()=>{F(""),es({key:"",direction:"descending"})},children:"Clear Filters"})})]}),(0,a.jsx)("div",{className:"overflow-auto p-4",children:(0,a.jsxs)("table",{className:"min-w-full table-auto bg-white rounded overflow-hidden shadow whitespace-nowrap",children:[(0,a.jsx)("thead",{className:"bg-gray-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("shipment_id"),children:["Shipment ID ",ei("shipment_id")]}),(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("store"),children:["Store ",ei("store")]}),(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("shipping_class"),children:["Shipping Class ",ei("shipping_class")]}),(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("status"),children:["Status ",ei("status")]}),(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("confirmed_delivery"),children:["Delivery Confirmation ",ei("confirmed_delivery")]}),(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("weight_in_kg"),children:["Weight ",ei("weight_in_kg")]}),(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("pieces_count"),children:["Pieces ",ei("pieces_count")]}),(0,a.jsx)("th",{className:"text-center py-2.5 px-4",children:"Dimensions"}),(0,a.jsxs)("th",{className:"text-center py-2.5 px-4 cursor-pointer relative",onClick:()=>er("created_at"),children:["Created On ",ei("created_at")]}),(0,a.jsx)("th",{className:"text-center py-2.5 px-4",children:"Actions"})]})}),U?(0,a.jsx)("tbody",{className:"divide-y",children:Array.from({length:15}).map((e,t)=>(0,a.jsx)("tr",{className:"divide-x",children:Array(10).fill(0).map((e,t)=>(0,a.jsx)("td",{className:"py-3.5 px-4 text-center",children:(0,a.jsx)(b.X,{className:"h-5 rounded-full"})},t))},t))}):t&&t.length>0?(0,a.jsx)("tbody",{className:"divide-y",children:t.map((e,t)=>(0,a.jsxs)("tr",{className:"divide-x",children:[(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:e.shipment_id}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:e.store}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:e.shipping_class}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:"completed"!==e.status?(0,a.jsxs)("select",{name:"status",id:"status-".concat(e.shipment_id),className:"px-2 py-1 border border-gray-300 rounded ring-accent",value:Z[e.shipment_id],onChange:t=>{ec(e.shipment_id,t.target.value)},children:[(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"shipped",children:"Shipped"})]}):"Delivered"}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:!0===e.confirmed_delivery?"Confirmed":"Not Confirmed"}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:e.weight_in_kg}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:e.pieces_count||"-"}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:Object.values(e.box_dimensions).join(" x ")}),(0,a.jsx)("td",{className:"py-2.5 px-2 text-center",children:e.created_at?(0,o.a)(e.created_at):"-"}),(0,a.jsxs)("td",{className:"py-3 px-2 text-sm font-medium flex justify-center gap-x-2",children:[(0,a.jsx)(h(),{href:"/dashboard/shipments/shipment/".concat(e.shipment_id),className:"p-1.5 rounded transition-all text-sky-500 hover:text-white bg-sky-100 hover:bg-sky-500 ring-custom ring-sky-500 fas fa-eye"}),(0,a.jsx)("button",{className:"fas fa-download py-1 px-1.5 bg-accent-dimmed accent hover:bg-accent hover:text-white rounded ring-accent",onClick:()=>eg(e.shipment_id)}),"pending"!==e.status&&"delhivery"===e.shipping_class&&(0,a.jsx)("button",{className:"py-1 px-1.5 rounded transition-all text-purple-500 hover:text-white bg-purple-100 hover:bg-purple-500 ring-custom ring-purple-500",onClick:()=>ed(e.shipment_id),children:(0,a.jsx)("i",{className:"bi bi-truck"})}),"delhivery"===e.shipping_class&&(0,a.jsxs)("button",{className:"text-blue-500 hover:text-white bg-blue-100 hover:bg-blue-500 py-1 px-1.5 rounded transition-all ring-custom ring-blue-500",onClick:()=>eo(e.shipment_id),children:["Slip ",(0,a.jsx)("i",{className:"bi bi-printer"})]}),(0,a.jsx)("button",{className:"text-red-500 hover:text-white bg-red-100 hover:bg-red-500 py-1 px-1.5 rounded transition-all ring-custom ring-red-500",onClick:()=>el(e.shipment_id),children:(0,a.jsx)("i",{className:"bi bi-trash-fill"})})]})]},t))}):(0,a.jsx)("td",{className:"w-full border py-4 text-center text-red-500 font-semibold","aria-colspan":9,colspan:9,children:"No entries to show!"})]})}),(0,a.jsx)(i.Z,{itemsPerPage:d,setItemsPerPage:u,currentPage:m,setCurrentPage:p,totalEntries:R,totalPages:q})]})})]}),(0,a.jsx)(y.R,{isOpen:M,onOpenChange:W,size:"4xl",radius:"sm",children:(0,a.jsx)(j.A,{children:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.k,{className:"flex flex-col gap-1",children:"Request Pickup"}),(0,a.jsxs)(N.I,{children:[(0,a.jsxs)(v.b,{"aria-label":"Selection Table",selectionMode:"multiple",selectedKeys:G,onSelectionChange:e=>{K(e),em(e)},checkboxesProps:{classNames:{wrapper:"after:bg-accent after:text-white text-white"}},classNames:{base:"rounded"},radius:"none",className:"".concat($.table?"border border-red-300":""," rounded"),children:[(0,a.jsx)(_.J,{columns:H,children:e=>(0,a.jsx)(k.j,{children:e.label},e.key)}),(0,a.jsx)(S.y,{items:t,isLoading:U,loadingContent:(0,a.jsx)(C.c,{label:"Loading...",color:"success"}),children:e=>!e.shipping_requested_date&&"delhivery"===e.shipping_class&&(0,a.jsx)(D.g,{children:t=>(0,a.jsx)(A.X,{children:(0,E.sF)(e,t)})},e.shipment_id)})]}),$.table&&(0,a.jsx)("p",{className:"text-red-500 text-sm",children:$.table}),(0,a.jsx)("div",{className:"w-full grid grid-cols-2 gap-x-4",children:(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)("label",{htmlFor:"requestedOn",className:"mb-1",children:"Requested On:"}),(0,a.jsx)("input",{type:"datetime-local",name:"requestedOn",id:"requestedOn",value:V,onChange:e=>{eu(e),Y(e.target.value)},className:"px-2 py-2 rounded border w-full border-gray-300 ring-accent ".concat($.requestedOn?"border-red-300":"")}),$.requestedOn&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1 absolute -bottom-5",children:$.requestedOn})]})})]}),(0,a.jsxs)(O.R,{children:[(0,a.jsx)(f.A,{color:"danger",variant:"light",radius:"sm",onPress:e,children:"Close"}),(0,a.jsx)(f.A,{color:"success",className:"text-white rounded",onPress:()=>ex(e),children:"Request Pickup"})]})]})})})]})}},39840:function(e,t,s){"use strict";s.d(t,{u:function(){return r}});var a=s(9134),n=s(83454);async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var r,i;let a=localStorage.getItem("token");String(n.env.NEXT_PUBLIC_CUSTOMER_ID);let c=await fetch("".concat("https://buybackservice.unicornstore.in","/").concat(e),{...t,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a),...null!==(r=null==t?void 0:t.headers)&&void 0!==r?r:void 0}});if(!c.ok)throw Error("Something went wrong ".concat(c.status));if(""===s){let e=await c.json();if("success"!==e.status)throw Error(null!==(i=null==e?void 0:e.message)&&void 0!==i?i:"Something went wrong (status !=='success' and no message)");return e}{let e=await c.blob(),t=window.URL.createObjectURL(e),a=document.createElement("a");return a.href=t,a.setAttribute("download",s),document.body.appendChild(a),a.click(),a.remove(),null}}catch(e){a.Am.error(e.message)}}}},function(e){e.O(0,[8166,7242,934,8278,7707,2888,9774,179],function(){return e(e.s=91950)}),_N_E=e.O()}]);